<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escape Game Test</title>
</head>

<body>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>

        'use strict';

        console.log('Game is loading...[start compilation]');

        let canvas;
        let canvastContext;

        let ball = {
            x: {
                pos: 75,
                speed: 5
            },
            y: {
                pos: 75,
                speed: 7
            }
        };

        let paddle = {
            width: 100,
            height: 10,
            pos: {
                x: 400,
                y: 100
            }
        };

        const PADDLE_THICKNESS = paddle.height;
        const PADDLE_WIDTH = paddle.width;
        const PADDLE_TOP = PADDLE_THICKNESS * 5;

        window.onload = function () {
            console.log('Game is loading...[setting game parameters...]');
            canvas = document.querySelector('#gameCanvas');
            canvastContext = canvas.getContext('2d');

            console.log('Game is loading...[game parameters set]');
            init();
        };

        function updateMousePos(e) {
            let rect = canvas.getBoundingClientRect();
            let root = document.documentElement;

            let mouseX = e.clientX - rect.left - root.scrollLeft;

            paddle.pos.x = mouseX - (PADDLE_WIDTH / 2);
        }

        function addEventListeners() {
            canvas.addEventListener('mousemove', updateMousePos);
        }

        function init() {
            console.log('Game has loaded.');
            console.log('Menu here.');

            addEventListeners();

            let framesPerSecond = 30;
            setInterval(updateScreen, 1000 / framesPerSecond);
        }

        function drawCanvas() {
            let canvasBackground = 'black';
            drawRect(0, 0, canvas.width, canvas.height, canvasBackground);
        }

        function drawRect(topLeftX, topLeftY, width, height, fillColor) {
            canvastContext.fillStyle = fillColor;
            canvastContext.fillRect(topLeftX, topLeftY, width, height);
        }

        function drawCircle(centerX, centerY, radius, fillColor) {
            canvastContext.fillStyle = fillColor;
            canvastContext.beginPath();
            canvastContext.arc(centerX, centerY, radius, 0, Math.PI * 2, true);
            canvastContext.fill();
        }


        // ADDING YOU OWN FUNCTIONALITY    
        function updateScreen() {
            drawCanvas();
            drawBall();
            moveBall();
            drawPaddle();
            paddleCollision();
        }


        // START: GAME SPECIFIC FUNCTIONALITY METHODS

        function drawBall() {
            let ballBackground = 'red';
            drawCircle(ball.x.pos, ball.y.pos, 10, ballBackground);
        }

        function moveBall() {
            ball.x.pos += ball.x.speed;
            ball.y.pos += ball.y.speed;

            setBallBoundries();
        }

        function ballReset() {
            ball.x.pos = canvas.width / 2;
            ball.y.pos = canvas.height / 2;
        }

        function setBallBoundries() {
            // set left
            if (ball.x.pos < 0) {
                ball.x.speed *= -1;
            }
            // set right
            if (ball.x.pos > canvas.width) {
                ball.x.speed *= -1;
            }
            // set top
            if (ball.y.pos < 0) {
                ball.y.speed *= -1;
            }
            // set bottom
            if (ball.y.pos > canvas.height) {
                ballReset();
            }
        }

        function drawPaddle() {
            let paddleBackground = 'white';
            drawRect(paddle.pos.x,
                canvas.height - PADDLE_TOP,
                PADDLE_WIDTH,
                PADDLE_THICKNESS,
                paddleBackground
            );
        }

        function paddleCollision() {
            let topOfPaddle = canvas.height - PADDLE_TOP;
            if (ball.y.pos > topOfPaddle &&
                ball.y.pos < topOfPaddle + PADDLE_THICKNESS &&
                ball.x.pos > paddle.pos.x &&
                ball.x.pos < paddle.pos.x + PADDLE_WIDTH) {
                    ball.y.speed *= -1;
                    
                    let centerOfPaddle = paddle.pos.x + (PADDLE_WIDTH / 2);
                    let ballDistFromPaddleCenter = ball.x.pos - centerOfPaddle;
                    ball.x.speed = ballDistFromPaddleCenter * 0.35;
                }
        }

        // END: GAME SPECIFIC FUNCTIONALITY METHODS

        console.log('Game is loading...[compilation finished]');
    </script>

</body>

</html>