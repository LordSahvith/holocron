<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escape Game Test</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            padding: 40px 20px;
        }

        #gameCanvas {
            width: 100%;
            height: auto;
            min-width: 400px;
            min-height: 300px;
            max-width: 800px;
            max-height: 600px;
        }
    </style>

</head>

<body>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>

        'use strict';
        console.group('Brick Breaker Load');
        console.group('Game Compilation');
        console.log('compilation started...');

        let canvas;
        let canvastContext;

        let ball = {
            x: {
                pos: 75,
                speed: 5
            },
            y: {
                pos: 75,
                speed: 7
            }
        };

        let paddle = {
            width: 100,
            height: 10,
            pos: {
                x: 400,
                y: 100
            }
        };

        const PADDLE_THICKNESS = paddle.height;
        const PADDLE_WIDTH = paddle.width;
        const PADDLE_TOP = PADDLE_THICKNESS * 5;

        let mouse = {
            x: 0,
            y: 0
        }

        let layout1 = [
            1, 1, 1, 1, 1, 1, 1, 1,
            1, 1, 1, 1, 1, 1, 1, 1,
            1, 1, 1, 1, 1, 1, 1, 1,
            1, 1, 1, 1, 1, 1, 1, 1
        ];

        let layout2 = [
            1, 1, 1, 1, 0, 1, 1, 1,
            1, 1, 0, 1, 1, 1, 1, 1,
            1, 1, 1, 1, 1, 1, 0, 1,
            1, 1, 1, 1, 1, 1, 1, 1,
            1, 0, 0, 0, 0, 1, 0, 1
        ];

        let levelInfo = {
            level1: {
                brick: {
                    width: 100,
                    height: 50,
                    gap: 2,
                    layout: layout1
                }
            },
            level2: {
                brick: {
                    width: 100,
                    height: 20,
                    gap: 2,
                    layout: layout2
                }
            }
        }

        let currentLevel = 'level1';
        let currentLevelInfo = levelInfo[currentLevel];

        window.onload = function () {
            console.group('Set Game Parameters');
            console.log('setting game parameters...');
            canvas = document.querySelector('#gameCanvas');
            canvastContext = canvas.getContext('2d');

            console.log('game parameters set');
            console.groupEnd();
            init();
        };


        // ADDING YOU OWN FUNCTIONALITY    
        function updateScreen() {
            drawCanvas();
            drawBall();
            moveBall();
            drawPaddle();
            paddleCollision();
            drawBricks();

            // TODO: mouse coords debug lines
            let brickX = mouse.x / currentLevelInfo.brick.width;
            let brickY = mouse.y / currentLevelInfo.brick.height;
            drawText(`${brickX},${brickY}`, mouse.x, mouse.y, 'yellow');
        }

        // START: BASE ENGINE FUNCTIONS

        function updateMousePos(e) {
            let rect = canvas.getBoundingClientRect();
            let root = document.documentElement;

            mouse.x = e.clientX - rect.left - root.scrollLeft;
            mouse.y = e.clientY - rect.top - root.scrollTop;

            paddle.pos.x = mouse.x - (PADDLE_WIDTH / 2);
        }

        function addEventListeners() {
            canvas.addEventListener('mousemove', updateMousePos);
        }

        function init() {
            console.log('Game build sucessful.');
            console.groupEnd();
            console.log('Game Menu.');

            addEventListeners();

            let framesPerSecond = 30;
            setInterval(updateScreen, 1000 / framesPerSecond);
        }

        function drawCanvas() {
            let canvasBackground = 'black';
            drawRect(0, 0, canvas.width, canvas.height, canvasBackground);
        }

        function drawRect(topLeftX, topLeftY, width, height, fillColor) {
            canvastContext.fillStyle = fillColor;
            canvastContext.fillRect(topLeftX, topLeftY, width, height);
        }

        function drawCircle(centerX, centerY, radius, fillColor) {
            canvastContext.fillStyle = fillColor;
            canvastContext.beginPath();
            canvastContext.arc(centerX, centerY, radius, 0, Math.PI * 2, true);
            canvastContext.fill();
        }

        function drawText(text, xPos, yPos, color) {
            canvastContext.fillStyle = color;
            canvastContext.fillText(text, xPos, yPos);
        }

        // END: BASE ENGINE FUNCTIONS


        // START: GAME SPECIFIC FUNCTIONALITY METHODS

        function drawBall() {
            let ballBackground = 'red';
            drawCircle(ball.x.pos, ball.y.pos, 10, ballBackground);
        }

        function moveBall() {
            ball.x.pos += ball.x.speed;
            ball.y.pos += ball.y.speed;

            setBallBoundries();
        }

        function ballReset() {
            ball.x.pos = canvas.width / 2;
            ball.y.pos = canvas.height / 2;
        }

        function setBallBoundries() {
            // set left
            if (ball.x.pos < 0) {
                ball.x.speed *= -1;
            }
            // set right
            if (ball.x.pos > canvas.width) {
                ball.x.speed *= -1;
            }
            // set top
            if (ball.y.pos < 0) {
                ball.y.speed *= -1;
            }
            // set bottom
            if (ball.y.pos > canvas.height) {
                ballReset();
            }
        }

        function drawPaddle() {
            let paddleBackground = 'white';
            drawRect(paddle.pos.x,
                canvas.height - PADDLE_TOP,
                PADDLE_WIDTH,
                PADDLE_THICKNESS,
                paddleBackground
            );
        }

        function paddleCollision() {
            let topOfPaddle = canvas.height - PADDLE_TOP;
            if (ball.y.pos > topOfPaddle &&
                ball.y.pos < topOfPaddle + PADDLE_THICKNESS &&
                ball.x.pos > paddle.pos.x &&
                ball.x.pos < paddle.pos.x + PADDLE_WIDTH) {
                ball.y.speed *= -1;

                let centerOfPaddle = paddle.pos.x + (PADDLE_WIDTH / 2);
                let ballDistFromPaddleCenter = ball.x.pos - centerOfPaddle;
                ball.x.speed = ballDistFromPaddleCenter * 0.35;
            }
        }

        function drawBricks() {
            let brickBackground = ['blue', 'purple', 'green', 'red'];
            let brick = currentLevelInfo.brick;
            let rowCount = (brick.layout.length * brick.width) / canvas.width;
            let colCount = brick.layout.length / rowCount;
            let brickNumber = 0;

            for (let row = 0; row < rowCount; row++) {
                for (let col = 0; col < colCount; col++) {
                    if (brick.layout[brickNumber] === 1) {
                        drawRect(brick.width * col, brick.height * row, brick.width - brick.gap, brick.height - brick.gap, brickBackground[row]);
                    }
                    brickNumber++;
                }
            }
        }

        // END: GAME SPECIFIC FUNCTIONALITY METHODS

        console.log('compilation finished.');
        console.groupEnd();
    </script>

</body>

</html>